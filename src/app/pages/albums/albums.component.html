<div class="main-content">
  <div class="categories">
    <ul>
      <li
        [class.checked] = '!searchParams.subcategory'
        (click)="changeSubCategory()">全部</li>
      <li
        *ngFor="let item of categoryInfo?.subcategories"
        (click)="changeSubCategory(item)"
        [class.checked] = 'item.code === searchParams.subcategory'
      >{{item.displayValue}}</li>
    </ul>
  </div>
  <div class="conditions">
    <ng-container *ngFor="let row of categoryInfo?.metadata">
      <div class="row" *ngIf="showMateRow(row.name)">
        <b class="title">{{row.name}}</b>
        <ul class="tabs">
          <li class="tag" (click)="changeMate(row, item)" *ngFor="let item of row?.metaValues">{{item.displayName}}</li>
        </ul>
      </div>
    </ng-container>
    <!--三级分类筛选-->
    <div class="row checked-conditions" *ngIf="checkedMetas.length">
      <b class="title">已筛选</b>
      <ul class="tabs">
        <li class="tag checked" *ngFor="let item of checkedMetas">
          <span class="label-title">{{item.metaRowName}}</span>
          <app-tag [xmClosable]="true" (closed)="unCheckMate(item)">{{item.metaName}}</app-tag>
        </li>
      </ul>
      <a class="clear" (click)="unCheckMate('clear')">清除全部</a>
    </div>
  </div>
  <div class="albums">
    <div class="album-head">
      <div class="title">
        <b>{{ albumsInfo?.pageConfig.h1title }}</b>
      </div>
      <ul class="sort">
        <li
          [class.checked]="i === searchParams.sort"
          *ngFor="let item of sorts; index as i"
          (click)="changeSort(i)">
          {{item}}
        </li>
      </ul>
    </div>

    <div class="album-cards" *ngIf="albumsInfo;else skeleton">
      <div class="album-card" [routerLink]="['/album', album.albumId]" *ngFor="let album of albumsInfo?.albums;">
        <div class="cover">
          <!--    图片地址加上!strip=1&quality=7&magick=webp&op_type=3&columns=290&rows=290，尺寸就会变为140 * 140      -->
          <img class="thumbnail" [src]="album.coverPath + '!strip=1&quality=7&magick=webp&op_type=3&columns=290&rows=290'" [alt]="[album.title]">
          <img class="icon-play" src="assets/images/icon-play-cover.png" />
          <p class="listen-count">
            <i appIcon="headset" class="icon"></i>
            <span>{{ album.playCount | numberFormat: 2 }}</span>
          </p>
        </div>
        <div class="abstract">
          <p class="txt title ellipsis">
<!--            <span *ngIf="album.isFinished === 2" class="tag">完本</span>-->
            <app-tag *ngIf="album.isFinished === 2" class="tag" [xmColor]="'green'">完本</app-tag>
            <span>{{ album.title }}</span>
          </p>
          <p class="txt author ellipsis"><span>{{ album.anchorName }}</span></p>
        </div>
      </div>
    </div>
  </div>

  <ng-template #skeleton>
    <svg role="img" aria-labelledby="Loading interface..." viewBox="0 0 400 130" preserveAspectRatio="xMidYMid meet">
      <title>Loading interface...</title>
      <rect x="0" y="0" width="400" height="130" clip-path="url(#k8vk4h3v2qo)"
            style="fill: url(&quot;#j1umtr4lgr&quot;);"></rect>
      <defs>
        <clipPath id="k8vk4h3v2qo">
          <rect x="0" y="0" rx="3" ry="3" width="250" height="10"></rect>
          <rect x="20" y="20" rx="3" ry="3" width="220" height="10"></rect>
          <rect x="20" y="40" rx="3" ry="3" width="170" height="10"></rect>
          <rect x="0" y="60" rx="3" ry="3" width="250" height="10"></rect>
          <rect x="20" y="80" rx="3" ry="3" width="200" height="10"></rect>
          <rect x="20" y="100" rx="3" ry="3" width="80" height="10"></rect>
        </clipPath>
        <linearGradient id="j1umtr4lgr">
          <stop offset="0.866418" stop-color="#f0f0f0" stop-opacity="1">
            <animate attributeName="offset" values="-3; 1" dur="2s" repeatCount="indefinite"></animate>
          </stop>
          <stop offset="1.86642" stop-color="#e0e0e0" stop-opacity="1">
            <animate attributeName="offset" values="-2; 2" dur="2s" repeatCount="indefinite"></animate>
          </stop>
          <stop offset="2.86642" stop-color="#f0f0f0" stop-opacity="1">
            <animate attributeName="offset" values="-1; 3" dur="2s" repeatCount="indefinite"></animate>
          </stop>
        </linearGradient>
      </defs>
    </svg>
  </ng-template>

  <div class="page-wrap">
    <app-pagination
      [pageNum]="searchParams.page"
      [pageSize]="searchParams.perPage"
      [total]="total"
      (change)="changePage($event)"
      class="page">
    </app-pagination>
  </div>
</div>

